name: ðŸ”„ Cáº­p nháº­t danh sÃ¡ch bÃ i há»c

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 * * * *'  # Cháº¡y má»—i giá»

jobs:
  update-list:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: ðŸ“‚ Táº¡o danh sÃ¡ch cÃ¡c file HTML (trá»« MAIN.html)
        run: |
          # Lá»c cÃ¡c file HTML, loáº¡i trá»« MAIN.html vÃ  khÃ´ng phÃ¢n biá»‡t hoa thÆ°á»ng
          find . -maxdepth 1 -name "*.html" | sed 's/^\.\///' | grep -v -i "MAIN.html" | sort > temp-files.txt

          # Táº¡o file danh-sach.json
          echo "[" > danh-sach.json
          first=true
          while IFS= read -r file; do
            if [ "$first" = true ]; then
              first=false
            else
              echo "," >> danh-sach.json
            fi
            # Escape kÃ½ tá»± Ä‘áº·c biá»‡t náº¿u cáº§n
            safe_name=$(echo "$file" | sed 's/"/\\"/g')
            echo "  {\"name\": \"$safe_name\", \"url\": \"https://maitheduy.github.io/TiengAnh6/$safe_name\"}" >> danh-sach.json
          done < temp-files.txt
          echo -e "\n]" >> danh-sach.json

      - name: âœ… Commit vÃ  Ä‘áº©y lÃªn náº¿u cÃ³ thay Ä‘á»•i
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add danh-sach.json
          git diff --quiet && git diff --staged --quiet || git commit -m "ðŸ”§ Cáº­p nháº­t danh sÃ¡ch file tá»± Ä‘á»™ng"
          git push
